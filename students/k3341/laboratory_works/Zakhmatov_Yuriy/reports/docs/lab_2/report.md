# –õ–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–∞—è —Ä–∞–±–æ—Ç–∞ 2

---

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å—Ç–æ–≥–æ —Å–∞–π—Ç–∞ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ DJANGO

**–¶–µ–ª—å**: –û–≤–ª–∞–¥–µ—Ç—å –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–º–∏ –Ω–∞–≤—ã–∫–∞–º–∏ –∏ —É–º–µ–Ω–∏—è–º–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ web-—Å–µ—Ä–≤–∏—Å–æ–≤
—Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ Django 2.2.

**–ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –∑–∞–¥–∞–Ω–∏–µ:** –†–µ–∞–ª–∏—â–æ–≤–∞—Ç—å —Å–∞–π—Ç –∏—Å–ø–æ–ª—å–∑—É—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫ Django 3 –∏ –°–£–ë–î PostgreSQL *, –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–æ–º –∑–∞–¥–∞–Ω–∏—è –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–Ω–æ–π —Ä–∞–±–æ—Ç—ã.

**–í–∞—Ä–∏–∞–Ω—Ç:** 2 (8 –Ω–æ–º–µ—Ä –≤ –∂—É—Ä–Ω–∞–ª–µ)

**–î–æ—Å–∫–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π.**

–û –¥–æ–º–∞—à–Ω–µ–º –∑–∞–¥–∞–Ω–∏–∏ –¥–æ–ª–∂–Ω–∞ —Ö—Ä–∞–Ω–∏—Ç—å—Å—è —Å–ª–µ–¥—É—é—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è: –ø—Ä–µ–¥–º–µ—Ç,
–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å, –¥–∞—Ç–∞ –≤—ã–¥–∞—á–∏, –ø–µ—Ä–∏–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, —Ç–µ–∫—Å—Ç –∑–∞–¥–∞–Ω–∏—è, –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —à—Ç—Ä–∞—Ñ–∞—Ö.
–ù–µ–æ–±—Ö–æ–¥–∏–º–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Å–ª–µ–¥—É—é—â–∏–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:

* –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π.
* –ü—Ä–æ—Å–º–æ—Ç—Ä –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π –ø–æ –≤—Å–µ–º –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞–º (—Å—Ä–æ–∫–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è, –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–¥–∞–Ω–∏—è).
* –°–¥–∞—á–∞ –¥–æ–º–∞—à–Ω–∏—Ö –∑–∞–¥–∞–Ω–∏–π –≤ —Ç–µ–∫—Å—Ç–æ–≤–æ–º –≤–∏–¥–µ.
* –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä (—É—á–∏—Ç–µ–ª—å) –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –ø–æ—Å—Ç–∞–≤–∏—Ç—å –æ—Ü–µ–Ω–∫—É –∑–∞ –∑–∞–¥–∞–Ω–∏–µ —Å—Ä–µ–¥—Å—Ç–≤–∞–º–∏ Django-admin.
* –í –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–π —á–∞—Å—Ç–∏ –¥–æ–ª–∂–Ω–∞ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å—Å—è —Ç–∞–±–ª–∏—Ü–∞, –æ—Ç–æ–±—Ä–∞–∂–∞—é—â–∞—è –æ—Ü–µ–Ω–∫–∏
–≤—Å–µ—Ö —É—á–µ–Ω–∏–∫–æ–≤ –∫–ª–∞—Å—Å–∞.

---
 
## –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ä–∞–±–æ—Ç—ã

1. –°–æ–∑–¥–∞–Ω–∏–µ –ë–î –Ω–∞—à–µ–≥–æ —Å–∞–π—Ç–∞:

~~~python
from django.db import models
from django.contrib.auth.models import User

# Create your models here.

class Subject(models.Model):
    name = models.CharField(max_length=30)
    teacher = models.CharField(max_length=30)
    teacher_email = models.EmailField()

    def __str__(self):
        return self.name

class Homework(models.Model):
    subject = models.ForeignKey(Subject,on_delete=models.CASCADE)
    issue_date = models.DateField()
    due_date = models.DateField()
    description = models.TextField()
    penalty_info = models.TextField(blank=True, null=True)

    def __str__(self):
        return f"{self.subject.name}: {self.description[:100]}"

    def get_last_submission(self, user):
        """–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Å–ª–µ–¥–Ω—é—é —Å–¥–∞—á—É –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è"""
        return self.submission_set.filter(student=user).order_by('-submitted_at').first()


class Submission(models.Model):
    HOMEWORK_STATUS = [
        ('submitted', 'üì§ –°–¥–∞–Ω–æ'),
        ('graded', '‚úÖ –û—Ü–µ–Ω–µ–Ω–æ'),
        ('late', '‚ö†Ô∏è –°–¥–∞–Ω–æ —Å –æ–ø–æ–∑–¥–∞–Ω–∏–µ–º'),
        ('not_submitted', '‚è≥ –ù–µ —Å–¥–∞–Ω–æ'),
    ]

    homework = models.ForeignKey(Homework, on_delete=models.CASCADE)
    student = models.ForeignKey(User, on_delete=models.CASCADE)
    text = models.TextField()
    submitted_at = models.DateTimeField(auto_now_add=True)
    grade = models.PositiveSmallIntegerField(null=True, blank=True)
    status = models.CharField(
        max_length=20,
        choices=HOMEWORK_STATUS,
        default='not_submitted'
    )

    def save(self, *args, **kwargs):
        # –°–Ω–∞—á–∞–ª–∞ –≤—ã–∑—ã–≤–∞–µ–º —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–π save, —á—Ç–æ–±—ã —É—Å—Ç–∞–Ω–æ–≤–∏–ª–∏—Å—å auto_now_add –ø–æ–ª—è
        super().save(*args, **kwargs)

        # –ó–∞—Ç–µ–º –æ–±–Ω–æ–≤–ª—è–µ–º —Å—Ç–∞—Ç—É—Å, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if self.submitted_at and self.homework.due_date:
            if self.submitted_at.date() > self.homework.due_date:
                self.status = 'late'
            elif self.grade is not None:
                self.status = 'graded'
            elif self.text:
                self.status = 'submitted'
        elif self.grade is not None:
            self.status = 'graded'

        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–Ω–æ–≤–∞, –µ—Å–ª–∏ —Å—Ç–∞—Ç—É—Å –∏–∑–º–µ–Ω–∏–ª—Å—è
        if self._state.adding is False:  # –ï—Å–ª–∏ –æ–±—ä–µ–∫—Ç —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            super().save(update_fields=['status'])

    def __str__(self):
        return f"{self.student.username} - {self.homework.subject.name} ({self.get_status_display()})"
~~~

2. –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î

![img.png](screenshots%2Fimg.png)

3. –°–æ–∑–¥–∞–µ–º –∞–¥–º–∏–Ω–∫—É

```python
from django.contrib import admin
from .models import Subject, Homework, Submission

# Register your models here.

@admin.register(Subject)
class SubjectAdmin(admin.ModelAdmin):
    list_display = ('name', 'teacher')

@admin.register(Homework)
class HomeworkAdmin(admin.ModelAdmin):
    list_display = ('subject', 'issue_date', 'due_date')
    list_filter = ('subject',)

@admin.register(Submission)
class SubmissionAdmin(admin.ModelAdmin):
    list_display = ('homework', 'student', 'status', 'grade', 'submitted_at')
    list_filter = ('homework', 'grade', 'status')
    search_fields = ('student__username', 'student__first_name', 'student__last_name')
    list_editable = ('status', 'grade')
    actions = ['delete_old_submissions']

    def delete_old_submissions(self, request, queryset):
        """–£–¥–∞–ª—è–µ—Ç –≤—Å–µ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–∞—á"""
        from django.db.models import Max

        # –ù–∞—Ö–æ–¥–∏–º ID –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–∞—á –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏ –∑–∞–¥–∞–Ω–∏—è
        latest_submissions = Submission.objects.values(
            'student', 'homework'
        ).annotate(
            latest_id=Max('id')
        ).values_list('latest_id', flat=True)

        # –£–¥–∞–ª—è–µ–º –≤—Å–µ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö
        deleted_count = Submission.objects.exclude(
            id__in=latest_submissions
        ).delete()[0]

        self.message_user(request, f"–£–¥–∞–ª–µ–Ω–æ {deleted_count} —Å—Ç–∞—Ä—ã—Ö —Å–¥–∞—á")

    delete_old_submissions.short_description = "–£–¥–∞–ª–∏—Ç—å –≤—Å–µ –∫—Ä–æ–º–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–∞—á"
```

4. –°–æ–∑–¥–∞–µ–º –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è

```python
from django.http import HttpResponseRedirect
from django.shortcuts import render
from django.contrib.auth.forms import UserCreationForm
from django.contrib.auth import login
from django.contrib.auth.decorators import login_required
from django.core.paginator import Paginator
from django.db.models import Q
from .models import Homework, Submission
from django.contrib.auth.models import User

# Create your views here.

#—Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
def register(request):
    if request.method == 'POST':
        form = UserCreationForm(request.POST)
        if form.is_valid():
            user = form.save()
            login(request, user)
            return HttpResponseRedirect('/')
    else:
        form = UserCreationForm()
    return render(request, 'tasks/register.html', {'form': form})


#–¥–æ–º–∞—à–Ω—è—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
@login_required(login_url='login')
def home(request):
    if not request.user.is_authenticated:
        return HttpResponseRedirect('register')

    query = request.GET.get('q')
    homeworks = Homework.objects.all().order_by('-due_date')

    if query:
        homeworks = homeworks.filter(
            Q(subject__name__icontains=query) |
            Q(description__icontains=query) |
            Q(subject__teacher__icontains=query)
        )

    paginator = Paginator(homeworks, 5)
    page_number = request.GET.get('page')
    page_obj = paginator.get_page(page_number)

    return render(request, 'tasks/home.html', {'page_obj': page_obj})


#–æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–¥–∞–Ω–∏—è
@login_required
def submit_homework(request, homework_id):
    homework = Homework.objects.get(id=homework_id)
    if request.method == 'POST':
        text = request.POST.get("text")
        submission = Submission.objects.create(
            homework=homework,
            student=request.user,
            text=text
        )
        return HttpResponseRedirect('/')
    return render(request, 'tasks/submit.html', {'homework': homework})


#–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
@login_required
def my_grades(request):
    """–õ–∏—á–Ω—ã–µ –æ—Ü–µ–Ω–∫–∏ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è"""
    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–∞—á–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
    from django.db.models import Max
    latest_submissions = Submission.objects.filter(
        student=request.user
    ).values(
        'homework'
    ).annotate(
        latest_id=Max('id')
    ).values_list('latest_id', flat=True)

    submissions = Submission.objects.filter(id__in=latest_submissions)
    return render(request, 'tasks/my_grades.html', {'submissions': submissions})


#–æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ—Ü–µ–Ω–æ–∫ –∫–ª–∞—Å—Å–∞
@login_required
def class_grades(request):
    """–¢–∞–±–ª–∏—Ü–∞ –æ—Ü–µ–Ω–æ–∫ –≤—Å–µ–≥–æ –∫–ª–∞—Å—Å–∞"""
    from django.db.models import Max

    # –ü–æ–ª—É—á–∞–µ–º ID –ø–æ—Å–ª–µ–¥–Ω–∏—Ö —Å–¥–∞—á –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å—Ç—É–¥–µ–Ω—Ç–∞ –∏ –∫–∞–∂–¥–æ–≥–æ –∑–∞–¥–∞–Ω–∏—è
    latest_submissions = Submission.objects.values(
        'student', 'homework'
    ).annotate(
        latest_id=Max('id')
    ).values_list('latest_id', flat=True)

    # –ë–µ—Ä–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–¥–∞—á–∏
    all_submissions = Submission.objects.filter(id__in=latest_submissions)

    # –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –ø–æ —Å—Ç—É–¥–µ–Ω—Ç–∞–º –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
    students = User.objects.all()
    homeworks = Homework.objects.all()

    # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã
    grades_data = []
    for student in students:
        student_grades = []
        total_grade = 0
        graded_count = 0

        for homework in homeworks:
            submission = all_submissions.filter(
                student=student,
                homework=homework
            ).first()
            grade = submission.grade if submission else None
            student_grades.append(grade)

            if grade is not None:
                total_grade += grade
                graded_count += 1

        # –í—ã—á–∏—Å–ª—è–µ–º —Å—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª
        average_grade = round(total_grade / graded_count, 1) if graded_count > 0 else None

        grades_data.append({
            'student': student,
            'grades': student_grades,
            'average_grade': average_grade
        })

    return render(request, 'tasks/class_grades.html', {
        'grades_data': grades_data,
        'homeworks': homeworks
    })
```

5. –°–æ–∑–¥–∞–µ–º urls

```python
from django.urls import path
from . import views

urlpatterns = [
    path('', views.home, name='home'),
    path('register/', views.register, name='register'),
    path('submit/<int:homework_id>/', views.submit_homework, name='submit_homework'),
    path('my-grades/', views.my_grades, name='my_grades'),
    path('class-grades/', views.class_grades, name='class_grades'),
]
```
 
##### –ì–ª–∞–≤–Ω—ã–π urls

```python
from django.contrib import admin
from django.urls import path, include
from django.contrib.auth import views as auth_views

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('tasks.urls')),
    path('login/', auth_views.LoginView.as_view(template_name='tasks/login.html'), name='login'),
    path('logout/', auth_views.LogoutView.as_view(next_page='login'), name='logout'),
]

```





